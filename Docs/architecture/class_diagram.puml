@startuml Class Diagram
title Class Diagram - Auth + Cases Home Data

class App {
  +resolveRoute(pathname): ReactNode
  +isLoggedIn(): boolean
  +handleLogout(): void
  +render()
}

class DesktopGate {
  +desktopMinWidth: number
  +isDesktop(): boolean
  +render()
}

class LoginPage {
  +formData
  +errors
  +handleSubmit()
  +render()
}

class LoggedHomePage {
  +user
  +homeData
  +loadHomeData()
  +render()
}

class LoggedHomeData {
  +normalizeHomeData(rawData)
  +formatAverageRating(value)
  +formatStatus(value)
  +formatReviews(value)
}

class LoggedSidebar {
  +activePath
  +user
  +onLogout()
  +render()
}

class AuthApiClient {
  +registerUser(payload)
  +loginUser(payload)
}

class CasesApiClient {
  +fetchLoggedHomeCases()
  +createCase(payload)
}

class SessionStorageService {
  +saveSession(token, user)
  +getSession()
  +clearSession()
}

class ExpressApp {
  +mountRoutes()
}

class AuthRoutes {
  +POST /register
  +POST /login
}

class CasesRoutes {
  +GET /home
  +POST /
}

class AuthGuardMiddleware {
  +requireAuth(req, res, next)
}

class AuthController {
  +registerController(req, res)
  +loginController(req, res)
}

class CasesController {
  +getLoggedHomeOverviewController(req, res)
  +createCaseController(req, res)
}

class AuthService {
  +registerUser(payload)
  +loginUser(payload)
}

class CasesService {
  +getLoggedHomeOverview(userId)
  +createCase(payload, userId)
}

class CasesValidation {
  +validateCreateCasePayload(payload)
}

class AuthRepository {
  +findUserByEmail(email)
  +createUser(userData)
}

class CasesRepository {
  +createCaseWithDetails(payload)
  +getHomeOverviewRows(userId)
}

class DatabaseModule {
  +initializeDatabase()
  +getDatabase()
  +applyMigrations()
}

class SQLiteDatabase {
  +users
  +cases
  +case_people
  +case_documents
  +case_timeline_items
  +case_user_progress
}

App --> DesktopGate
DesktopGate --> LoginPage
DesktopGate --> LoggedHomePage
LoggedHomePage *-- LoggedSidebar
LoggedHomePage ..> LoggedHomeData

App ..> SessionStorageService
LoginPage ..> AuthApiClient
LoggedHomePage ..> CasesApiClient
AuthApiClient ..> SessionStorageService
CasesApiClient ..> SessionStorageService

AuthApiClient ..> ExpressApp
CasesApiClient ..> ExpressApp
ExpressApp --> AuthRoutes
ExpressApp --> CasesRoutes
CasesRoutes --> AuthGuardMiddleware
AuthRoutes --> AuthController
CasesRoutes --> CasesController
AuthController --> AuthService
CasesController --> CasesService
CasesService --> CasesValidation
AuthService --> AuthRepository
CasesService --> CasesRepository
AuthRepository --> DatabaseModule
CasesRepository --> DatabaseModule
DatabaseModule --> SQLiteDatabase
@enduml
