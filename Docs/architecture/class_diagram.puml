@startuml Class Diagram
title Class Diagram - Workspace tabovi + publish dugme u kreiranju

class App {
  +resolveRoute(pathname): ReactNode
  +isLoggedIn(): boolean
  +handleLogout(): void
  +render()
}

class RouteUtils {
  +normalizePath(pathname)
  +buildCaseWorkspaceRoute(caseId, mode, tab)
  +buildCaseCreatorRoute(caseId)
  +parseCaseWorkspacePath(pathname)
}

class DesktopGate {
  +desktopMinWidth: number
  +isDesktop(): boolean
  +render()
}

class LoginPage {
  +formData
  +errors
  +handleSubmit()
  +render()
}

class LoggedHomePage {
  +user
  +homeData
  +loadHomeData()
  +render()
}

class LoggedCaseSection {
  +title
  +items
  +renderDetails()
  +render()
}

class LoggedHomeData {
  +normalizeHomeData(rawData)
  +formatAverageRating(value)
  +formatStatus(value)
  +formatReviews(value)
}

class LoggedSidebar {
  +activePath
  +user
  +onLogout()
  +render()
}

class CreateCasePage {
  +formData
  +formErrors
  +isSubmitting
  +handleCreateCase()
  +render()
}

class CaseWorkspacePage {
  +caseId
  +mode
  +activeTabSlug
  +loadCaseData()
  +render()
}

class CreateCaseSidebar {
  +mode
  +caseId
  +activeTabSlug
  +publishDisabled
  +publishStatusMessage
  +onPublish()
  +onLogout()
  +render()
}

class CaseWorkspaceTabs {
  +CASE_WORKSPACE_TABS
  +DEFAULT_CASE_WORKSPACE_TAB
  +findCaseWorkspaceTab(tabSlug)
}

class AuthApiClient {
  +registerUser(payload)
  +loginUser(payload)
}

class CasesApiClient {
  +fetchLoggedHomeCases()
  +createCase(payload)
  +fetchCreatorCase(caseId)
}

class SessionStorageService {
  +saveSession(token, user)
  +getSession()
  +clearSession()
}

class ExpressApp {
  +mountRoutes()
}

class AuthRoutes {
  +POST /register
  +POST /login
}

class CasesRoutes {
  +GET /home
  +POST /
  +GET /:caseId/creator
}

class AuthGuardMiddleware {
  +requireAuth(req, res, next)
}

class AuthController {
  +registerController(req, res)
  +loginController(req, res)
}

class CasesController {
  +getLoggedHomeOverviewController(req, res)
  +createCaseController(req, res)
  +getCreatorCaseController(req, res)
}

class AuthService {
  +registerUser(payload)
  +loginUser(payload)
}

class CasesService {
  +getLoggedHomeOverview(userId)
  +createCase(payload, userId)
  +getCreatorCase(caseId, userId)
}

class CasesValidation {
  +validateCreateCasePayload(payload)
}

class AuthRepository {
  +findUserByEmail(email)
  +createUser(userData)
}

class CasesRepository {
  +createCaseWithDetails(payload)
  +getHomeOverviewRows(userId)
  +findCaseByIdForAuthor(caseId, userId)
}

class DatabaseModule {
  +initializeDatabase()
  +getDatabase()
  +applyMigrations()
}

class SQLiteDatabase {
  +users
  +cases
  +case_people
  +case_documents
  +case_timeline_items
  +case_user_progress
}

App --> RouteUtils
App --> DesktopGate
DesktopGate --> LoginPage
DesktopGate --> LoggedHomePage
DesktopGate --> CreateCasePage
DesktopGate --> CaseWorkspacePage
LoggedHomePage *-- LoggedSidebar
LoggedHomePage *-- LoggedCaseSection
LoggedHomePage ..> LoggedHomeData
CreateCasePage *-- CreateCaseSidebar
CaseWorkspacePage *-- CreateCaseSidebar
CaseWorkspacePage ..> CaseWorkspaceTabs

App ..> SessionStorageService
LoginPage ..> AuthApiClient
LoggedHomePage ..> CasesApiClient
CreateCasePage ..> CasesApiClient
CaseWorkspacePage ..> CasesApiClient
AuthApiClient ..> SessionStorageService
CasesApiClient ..> SessionStorageService
CasesApiClient ..> RouteUtils
CreateCaseSidebar ..> CaseWorkspaceTabs
CreateCaseSidebar ..> RouteUtils

AuthApiClient ..> ExpressApp
CasesApiClient ..> ExpressApp
ExpressApp --> AuthRoutes
ExpressApp --> CasesRoutes
CasesRoutes --> AuthGuardMiddleware
AuthRoutes --> AuthController
CasesRoutes --> CasesController
AuthController --> AuthService
CasesController --> CasesService
CasesService --> CasesValidation
AuthService --> AuthRepository
CasesService --> CasesRepository
AuthRepository --> DatabaseModule
CasesRepository --> DatabaseModule
DatabaseModule --> SQLiteDatabase
@enduml
